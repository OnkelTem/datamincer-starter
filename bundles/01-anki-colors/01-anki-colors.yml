vars:
  buildName: 'DmsCss3Colors'
  buildPath:
    field: concat
    items: ['build/', '@bundle.name']
  deckGroup: 'DataMincer.Starter'
  deckName: 'CSS3 Colors'
  deckCode: '@vars.buildName'
  url:
    field: githuburl

generators:
  BuildDeck:
    workers:
      - worker: csv
        data:
          field: file
          path: 'DM_ Colors - Colors.csv'
        columns:
          color: color
          code: code
          group: group
          offset: offset
      - worker: crowdankideck
        build:
          name: '@vars.buildName'
          path: '@vars.buildPath'
        deck:
          uuid:
            field: uuid
          name:
            field: concat
            items: ['@vars.deckGroup', '@vars.deckName']
            glue: '::'
          desc:
            field: twig
            template:
              field: file
              path: desc.twig
        config:
          uuid:
            field: uuid
          name: '@vars.deckCode'
        model:
          uuid:
            field: uuid
          name: '@vars.deckCode'
          templates:
            main:
              field: twig
              template:
                field: file
                path: 'template.twig'
          css:
            field: file
            path: 'template.css'
        note:
          fields:
            color: '@row.color'
            code: '@row.code'
          guid:
            field: guid
        defaults:
          config:
            new:
              order: 0
          model:
            req: [[0, 'all', [2]]]
  ColorTable:
    workers:
      - worker: csv
        data:
          field: file
          path: 'DM_ Colors - Colors.csv'
        columns:
          color: color
          code: code
          group: group
          offset: offset
      - worker: group
        from: row
        by: [ ]
      - worker: process
        fields:
          elems:
            field: groupby
            list: '@row.items'
            by: [group, offset]
          table:
            field: chain
            items:
              - field: twig
                template:
                  field: file
                  path: table.twig
              - field: savefile
                contents: '@input'
                destination:
                  field: concat
                  items: ['@vars.buildPath', '/_table.html']

